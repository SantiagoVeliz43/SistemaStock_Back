generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
  runtime  = "bun"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Role {
  USER
  ADMIN
}

model User {
  id       String @id @default(uuid()) @db.Uuid
  email    String @unique
  fullName String
  password String
  role     Role   @default(USER)

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([id, email])
  @@map("Users")
}

model Medico {
  cedula_med   Int          @id
  nombre       String       @db.VarChar(15)
  apellido     String       @db.VarChar(15)
  especialidad Especialidad

  recetas Receta[]

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([cedula_med])
  @@map("Medicos")
}

enum Especialidad {
  CLINICO
  CIRUJANO
  PEDIATRA
  PSQUIATRA
  GINECOLOGO
}

model Paciente {
  nro_legajo Int      @id
  nombre     String   @db.VarChar(15)
  apellido   String   @db.VarChar(15)
  dni        Int      @unique
  fechaNac   DateTime
  telefono   String?  @db.VarChar(15)
  obraSocial String   @db.VarChar(50)
  direccion  String?  @db.VarChar(50)

  recetas Receta[]

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([nro_legajo])
  @@map("Pacientes")
}

model Farmaceutico {
  cedula_farma Int    @id
  nombre       String @db.VarChar(15)
  apellido     String @db.VarChar(15)
  clave_acceso String

  computadoras ComputadoraGeneral[]

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([clave_acceso])
  @@map("Farmaceuticos")
}

model Producto {
  id          Int               @id @default(autoincrement())
  nombre      String
  descripcion String
  stock       Int
  categProd   CategoriaProducto

  detalles_recetas DetallesReceta[]

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([id])
  @@map("Productos")
}

enum CategoriaProducto {
  INYECTABLE
  JARABE
  PILDORA
  SUPOSITORIO
  OVULO
  CREMA
  GOTA
  SPRAYS
}

model Receta {
  nro_receta        Int                  @id @default(autoincrement())
  medicoCedula      Int
  pacienteNroLegajo Int
  medico            Medico               @relation(fields: [medicoCedula], references: [cedula_med])
  paciente          Paciente             @relation(fields: [pacienteNroLegajo], references: [nro_legajo])
  detalles_recetas  DetallesReceta[]
  computadora       ComputadoraGeneral[]

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([nro_receta])
  @@map("Recetas")
}

model DetallesReceta {
  id_detallesReceta Int      @id @default(autoincrement())
  indicaciones      String
  fecha_emision     DateTime
  fecha_vencimiento DateTime
  recetaNroReceta   Int
  productoId        Int

  receta   Receta   @relation(fields: [recetaNroReceta], references: [nro_receta])
  producto Producto @relation(fields: [productoId], references: [id])

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([id_detallesReceta])
  @@map("Detalles de Recetas")
}

model ComputadoraGeneral {
  id_computadora     Int      @id
  clave_ingresada    String
  fecha_expen        DateTime
  farmaceuticoCedula Int
  recetaNroReceta    Int

  farmaceutico Farmaceutico @relation(fields: [farmaceuticoCedula], references: [cedula_farma])
  receta       Receta       @relation(fields: [recetaNroReceta], references: [nro_receta])

  createdAt DateTime  @default(now()) @db.Timestamptz(3)
  updatedAt DateTime? @updatedAt @db.Timestamptz(3)
  deletedAt DateTime? @db.Timestamptz(3)

  @@index([id_computadora])
  @@index([clave_ingresada])
  @@map("Computadora General")
}
